# 迁移与落地策略

## 迁移原则
- 先抽象 Profile，再迁移流程。
- 保留旧 Flow 入口，保证现场可用。
- 以“模板 + DSL”逐步替换硬编码逻辑。
- 每次迁移必须可回滚。

## 迁移步骤
1) 抽取坐标与选择器 → Profile。
2) 把现有 Flow 逻辑转成 DSL Step。
3) 将模块差异整理成模板库。
4) 用任务图编排替换固定顺序。
5) 对比新旧执行结果并记录差异。

## 双轨运行（建议）
- 初期同时运行旧 Flow 与新 DSL（比对结果）。
- 针对关键流程做 A/B 回归验证。
- 记录差异并作为模板完善依据。

## 迁移优先级（建议）
- P1：导入变量（稳定、低风险）。
- P2：程序块创建与粘贴。
- P3：硬件组态与模块配置。
- P4：通讯程序与混合流程。

## 兼容策略
- UiaRpcService 保留原有方法。
- 新增 RunFlowDsl 接口，逐步替换旧 RunFlow。
- 旧流程仅用于回归与兜底。

## 差异管理
- 记录 UI 版本差异（Profile 差异说明）。
- 记录行为差异（StepLog 对比）。
- 将差异归因到 Profile/Template/Flow。

## 推广策略
- 先迁移“导入变量/程序粘贴”等稳定流程。
- 再迁移“硬件组态/模块配置”等复杂流程。
- 最后迁移“通讯程序与混合流程”。

## 回滚策略
- Profile 版本可回滚。
- DSL 版本可回滚。
- Orchestrator 提供“只执行原流程”模式。

## 迁移验收要点
- 新旧流程执行结果一致或可解释。
- Evidence Pack 完整输出。
- 关键任务成功率不低于旧流程。
