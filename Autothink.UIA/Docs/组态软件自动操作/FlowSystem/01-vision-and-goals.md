# 目标、边界与术语

## 背景与痛点
- 当前流程主要靠代码+选择器硬编码，维护成本高。
- UI 变化频繁，导致重复修改流程逻辑。
- 复杂步骤（MFC 自绘区坐标）难以复用。
- 用户需要按模块类型自由调整执行顺序。

## 现有流程拆解（业务视角）
- 设备硬件信息组态：识别点表硬件信息 → 选择 CPU → 添加设备/协议 → 按模块类型添加模块 → 进入复杂参数设定。
- 添加设备变量：工程菜单导入变量表（XLS）。
- IO 与设备功能块生成：创建程序块 → 进入编辑区 → 粘贴模板程序。
- 通讯程序添加：与硬件组态/程序块交织完成（通讯模块配置+命令添加）。

## 输入/输出边界
- 输入（来自外部解析/规则系统）：
  - 点表解析结果：模块清单、槽号、机架位置、程序块清单、变量表路径。
  - 规则计算结果：地址/槽位/机架映射（不在 UIA 自动化范围内）。
  - 固定流程参数：模块类型 → 模板映射、必要的配置枚举。
- 输出（供验证/回放/验收）：
  - StepLog（逐步动作、参数摘要、耗时、失败原因）。
  - Evidence Pack（版本、环境、截图、摘要）。
  - 任务执行结果（成功/失败、失败节点）。

## 总体目标
- 让流程创建与变更通过配置完成，不需要修改代码。
- 让 UI 变化只影响 Profile 资产，不影响流程 DSL 与动作库。
- 让复杂流程具备可组合、可复用与可回放能力。
- 让用户可以自由选择执行顺序，同时由系统保障依赖关系。

## 用户创建流程的理想体验
1) 选择 Profile（对应 UI 版本/分辨率/语言）。
2) 选择模板组合（硬件/变量/程序/通讯）。
3) 填入点表解析后的参数与模块清单。
4) 选择执行顺序与起点（系统提示依赖）。
5) 一键执行并获得可回放证据。

## 成功指标（建议）
- UI 变化响应时间：Profile 更新 ≤ 1 天。
- 新流程上线周期：仅改模板与 DSL ≤ 2 天。
- 关键流程成功率：稳定在 95% 以上（按环境统计）。
- 失败定位粒度：必须定位到 Step/Selector/Coordinate/Policy 级别。

## 质量基线（必须满足）
- 关键动作可重试：坐标点击/导航/粘贴必须具备至少 1 次安全重试。
- 关键任务可恢复：执行失败后允许从最近成功 Task 继续。
- 参数可追溯：任意 Step 必须能回溯到 inputs/模板/映射来源。
- UI 变化隔离：UI 变化不得引入 DSL/模板修改。

## 非目标
- 不引入“智能定位/视觉识别替代 UIA”。
- 不自动推断地址计算规则或点表逻辑。
- 不支持多进程并发执行（保持 STA 单线程）。
- 不在本阶段提供完整可视化流程设计器（后续扩展）。

## 现阶段假设
- 操作对象为 Windows 桌面应用，UIA 可访问窗口层级。
- 自绘区域坐标经过现场校准后可稳定复用。
- 关键菜单与对话框标题在同一版本内稳定。

## 关键约束（已确认）
- 模块设置阶段依赖 MFC 自绘区域坐标：以左上角 (0,0) 为基准，坐标需现场校准并固化。
- 地址计算逻辑不属于 UIA 自动化范围，仅作为参数输入。
- 程序块清单来源于点表解析结果。
- 通讯流程按模块类型配置为固定模板；用户可选择执行顺序。

## 可变项与固定项
- 可变项：
  - UI 版本/分辨率/语言。
  - 模块类型与模块数量。
  - 用户选择的执行顺序与起点。
  - 现场参数（波特率、站号等）。
- 固定项：
  - MFC 自绘区坐标系原点定义。
  - UIA 单线程执行模型。
  - 输入参数来源（点表与规则计算）。

## 设计原则
- 数据驱动：流程行为由“输入参数 + 模板 + Profile”决定。
- 可组合：流程由任务图与子流程组成，可自由编排。
- 可回放：StepLog 作为证据链，保证可诊断与可验证。
- 可降级：支持 fallback 与 retry，避免一次失败导致整体中断。
- 可版本化：Profile、模板、流程均具备版本与兼容策略。

## 运行时保证
- 所有动作必须以可重试为优先设计（幂等或可安全重复）。
- 任何坐标点击必须可追溯到 Profile。
- 任何规则参数必须标记来源（输入/模板/系统默认）。

## 用户可选执行顺序
- 用户可以从任何 Task 开始执行。
- Orchestrator 必须校验依赖是否满足。
- 允许提示用户自动补齐依赖或跳过不可执行任务。

## 术语定义
- Flow：流程实例，包含任务图与参数。
- Task：可独立执行的任务节点（硬件组态/导入变量/程序块等）。
- Step：任务内的步骤序列。
- Action：最小原子动作（点击/键盘/等待/校验）。
- Template：可复用流程模板（按模块类型或业务场景组织）。
- Profile：UI 版本档案（锚点、坐标、选择器、导航序列）。
- Policy：运行期策略（重试、降级、失败处理）。
- Context：运行时上下文（会话、参数、变量、证据）。

## 流程活性（可配置）
- 允许按模块类型加载不同模板。
- 允许为同一流程选择不同 Profile 版本。
- 允许为同一步骤配置不同策略（retry/fallback）。
